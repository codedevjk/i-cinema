<div class="container-fluid pt-0 px-0 position-relative" *ngIf="show">

    <div class="back-link-container">
        <button class="btn btn-link text-white text-decoration-none p-0 d-flex align-items-center hover-white" [routerLink]="['/booking/shows', show.movieId]">
          <i class="bi bi-arrow-left me-2 fs-4"></i> Back to Shows
        </button>
    </div>

    <div class="container py-4 mt-5">
        <!-- Title & Movie Info -->
        <div class="text-center mb-5">
            <h1 class="h4 fw-bold mb-1">Select Your Seats</h1>
            <p class="text-secondary small mb-0">{{ movie?.title }} • {{ show.theatreName }} • {{ show.showTime }}</p>
        </div>

        <!-- Screen Visual -->
        <div class="screen-container">
            <div class="screen-glow"></div>
            <div class="screen-text"><i class="bi bi-display me-2"></i>Screen</div>
        </div>

        <!-- Legend -->
        <div class="d-flex justify-content-center gap-4 mb-5">
            <div class="d-flex align-items-center gap-2">
                <div class="seat-legend-box available"></div>
                <span class="legend-text">Available</span>
            </div>
            <div class="d-flex align-items-center gap-2">
                <div class="seat-legend-box selected"></div>
                <span class="legend-text">Selected</span>
            </div>
            <div class="d-flex align-items-center gap-2">
                <div class="seat-legend-box booked"></div>
                <span class="legend-text">Booked</span>
            </div>
        </div>

        <!-- Pricing Info -->
        <div class="d-flex justify-content-center gap-3 mb-5">
            <span class="badge-price">Premium (H-J) ₹220</span>
            <span class="badge-price">Regular (A-G) ₹180</span>
        </div>

        <!-- Seat Matrix -->
        <div class="seat-matrix">
            <div *ngFor="let group of groupedSeats" class="seat-row">
                <div class="row-label">{{ group.rowLabel }}</div>
                
                <div class="d-flex gap-2">
                    <button *ngFor="let seat of group.seats" class="seat-btn"
                        [ngClass]="{
                            'seat-available': seat.status === 'AVAILABLE' && !selectedSeatIds.includes(seat.id),
                            'seat-selected': selectedSeatIds.includes(seat.id),
                            'seat-booked': seat.status === 'BOOKED'
                        }"
                        [disabled]="seat.status === 'BOOKED'"
                        (click)="toggleSeat(seat)"
                        [title]="'Row ' + group.rowLabel + ' - ₹' + seat.price">
                        <span>{{ seat.seatNumber.substring(1) }}</span>
                    </button>
                </div>

                <div class="row-label">{{ group.rowLabel }}</div>
            </div>
        </div>

        <!-- Spacer -->
        <div style="height: 100px;"></div>

    </div>

    <!-- Fixed Bottom Bar -->
    <div class="fixed-bottom bottom-bar py-3" *ngIf="selectedSeatIds.length > 0">
        <div class="container d-flex justify-content-between align-items-center">
            
            <div class="selection-summary">
                <div class="text-secondary small mb-1">{{ selectedSeatIds.length }} seats selected</div>
                <div class="text-white fw-bold text-truncate" style="max-width: 400px;">
                    {{ getSelectedSeatsString() }}
                </div>
            </div>

            <div class="d-flex align-items-center gap-4">
                <div class="text-end">
                    <div class="text-secondary small">Total Amount</div>
                    <div class="text-white fw-bold fs-4 text-danger">₹{{ getTotalPrice() }}</div>
                </div>
                <button class="btn btn-proceed d-flex align-items-center gap-2" 
                        [disabled]="isProcessing" 
                        (click)="proceedToPay()">
                    <span>Proceed to Pay</span>
                    <i class="bi bi-arrow-right" *ngIf="!isProcessing"></i>
                    <span class="spinner-border spinner-border-sm" *ngIf="isProcessing"></span>
                </button>
            </div>

        </div>
    </div>

</div>